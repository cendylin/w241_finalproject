# age
t.test(df$age ~ df$treat_code, var.equal=F) # not significant
# apple
t.test(df$apple ~ df$treat_code, var.equal=F) # not significant
# personal phone
t.test(df$personal_phone ~ df$treat_code, var.equal=F) # not significant
# phone use
t.test(df$phone_use ~ df$treat_code, var.equal=F) # not significant
# relationship
t.test(df$relationship ~ df$treat_code, var.equal=F) # not significant
nrow(df)
data = read.csv("./data.csv")
nrow(data)
data
data = read.csv("./data.csv")
nrow(data)
df = data[data$full_attrit==0,]
nrow(df)
# view columns
names(df)
# drop username row for anonimity
df = df[,-1]
# encode gender (male = 1, female = 0)
df$male = 1
df$male[df$gender == "Female"] = 0
# encode age (<44 = 1, >44 = 0)
df$age_code = 1
df$age_code[df$age == "45-54" | df$age == "55-64"] = 0
# encode OS (Apple = 1, Other = 0)
df$apple = 1
df$apple[grep("Android", df$os)] = 0 # regex, if contains 'Android', encode as 1
df$apple[df$os == "Blackberry"] = 0
# encode num_phones (personal use phone = 0, work & personal phone = 1)
df$personal_phone = 0
df$personal_phone[grep("only", df$num_phones)] = 1
# encode phone_use (at least once an hour = 1, less than once an hour = 0)
df$phone_usage = 1
df$phone_usage[grep("4", df$phone_use)] = 0 # regex, if contains '4', encode as 1
# encode relationship (friend/fam = 1, other = 0)
df$relation = 1
df$relation[df$relationship == ""] = 0
# label treat as treatment/control
df$treat_group = "treatment"
df$treat_group[df$treat == 0] = "control"
# drop columns
df = df[,c(-2, -4, -5, -6, -7, -8 ,-9, -10, -11, -12)]
# reorder columns so stress observations on the right
df = df[c("id", "treat", "treat_group", "male", "age_code", "apple", "personal_phone",
"phone_usage", "relation", "c1", "c2", "c3", "c4", "c5", "c6", "c7",
"b1", "b2", "b3", "b4", "b5", "b6", "b7",
"t1", "t2", "t3", "t4", "t5", "t6", "t7")]
# change column names
colnames(df) <- c("id", "treat_code", "treat_group", "male", "age", "apple",
"personal_phone","phone_use", "relationship", "c1", "c2", "c3",
"c4", "c5", "c6", "c7", "b1", "b2", "b3", "b4", "b5", "b6",
"b7", "t1", "t2", "t3", "t4", "t5", "t6", "t7")
df2 = melt(df, id.var = c("id", "treat_code", "treat_group", "male", "age", "apple",
"personal_phone","phone_use", "relationship", "c1", "c2", "c3",
"c4", "c5", "c6", "c7"), variable.name = "day")
# recode 'day' column as number day
index = levels(df2$day)
values = c(1:14)
df2$day = values[match(df2$day, index)]
# reformat compliance columns
df2$comply = NA
a = which(df2$day == 8)
df2$comply[a] = df2$c1[a] # turns into factor
b = which(df2$day == 9)
df2$comply[b] = df2$c2[b]
c = which(df2$day == 10)
df2$comply[c] = df2$c3[c]
d = which(df2$day == 11)
df2$comply[d] = df2$c4[d]
e = which(df2$day == 12)
df2$comply[e] = df2$c5[e]
f = which(df2$day == 13)
df2$comply[f] = df2$c6[f]
g = which(df2$day == 14)
df2$comply[g] = df2$c7[g]
# Replace original values instead of factors
values = c(NA, 0, 1, "missing")
index = c(1:4)
df2$comply = values[match(df2$comply, index)]
# drop c1-c7, rename 'value' to 'stress'
df2 = df2[,c(-10, -11, -12, -13, -14, -15, -16)]
colnames(df2)[11] <- "stress"
head(df2)
nrow(df2)
min(df2$stress, na.rm=TRUE)
max(df2$stress, na.rm=TRUE)
sum(df2$stress, na.rm=TRUE)
# Age and Gender
d2 = data[data$full_attrit == 0,]
# label treat as treatment/control
d2$treat_group = "treatment"
d2$treat_group[d2$treat == 0] = "control"
position = c("Under 18", "18-24", "25-34", "35-44", "45-54", "55-64")
ggplot(data.frame(d2$age), aes(x=d2$age, fill = d2$gender)) +
geom_bar(position="dodge") +
scale_x_discrete(limits = position) +
ggtitle("Age Distribution by Gender") +
labs(x="Age Bin")
# Age and Treatment Group
ggplot(data.frame(d2$age), aes(x=d2$age, fill = d2$treat_group)) +
geom_bar(position="dodge") +
scale_x_discrete(limits = position) +
ggtitle("Age Distribution by Treatment Group") +
labs(x="Age Bin")
```
## Covariate balance check
```{r}
# Not using individual observations
# gender
t.test(df$male ~ df$treat_code, var.equal=F) # not significant
# age
t.test(df$age ~ df$treat_code, var.equal=F) # not significant
# apple
t.test(df$apple ~ df$treat_code, var.equal=F) # not significant
# personal phone
t.test(df$personal_phone ~ df$treat_code, var.equal=F) # not significant
# phone use
t.test(df$phone_use ~ df$treat_code, var.equal=F) # not significant
# relationship
t.test(df$relationship ~ df$treat_code, var.equal=F) # not significant
# create rows for difference-in-difference
baseline = df2[df2$day < 8,]
treatment = df2[df2$day > 7,]
did = treatment$stress - baseline$stress
# Build dataframe with DiD as outcome only
treat = df2[c(1:length(did)),]$treat_group
treat_code = df2[c(1:length(did)),]$treat_code
id = df2[c(1:length(did)),]$id
day = df2[c(1:length(did)),]$day
diff = data.frame(id, treat, treat_code, day, did)
# count of NA differences in treatment groups
sum(is.na(diff$did[diff$treat == "control"])) #38
sum(is.na(diff$did[diff$treat == "treatment"])) #61
# % NA DiD in control and treatment
38/sum(diff$treat == "control")
61/sum(diff$treat == "treatment")
# distribution by treatment group
ggplot(data.frame(diff$did), aes(x=diff$did, fill = diff$treat)) +
geom_bar(position="dodge") +
ggtitle("Difference in Difference of Stress Levels by Day of Week") +
labs(x="Stress DiD")
ggplot(data.frame(diff$did), aes(x=diff$treat, y=diff$did, fill=diff$treat)) +
geom_boxplot() +
ggtitle("Difference in Difference of Stress Levels by Day of Week") +
labs(x="Stress DiD")
nrow(diff)
nrow(diff$treat == "treatment")
length(diff$treat == "treatment")
length(diff$treat == "control")
diff
nrow(diff)
diff[diff$treat == "treatment", ]
nrow(diff[diff$treat == "treatment", ])
nrow(diff[diff$treat == "treatment", ])/7
nrow(diff[diff$treat == "control", ])/7
# model ignoring attrition and no clusters on ID
m1_wrong = lm(did ~ treat, data=diff)
summary(m1_wrong)
# model WITH clusters on ID but ignoring attrition
m1_wrong$cluster.vcov = cluster.vcov(m1_wrong, ~ id)
m1 = coeftest(m1_wrong, m1_wrong$cluster.vcov)
# model ignoring attrition and using fixed effects by individual ID
m2 = lm(did ~ treat + factor(id), data = diff)
m2$cluster.vcov = cluster.vcov(m2, ~ id)
m2a = coeftest(m2, m2$cluster.vcov)
# Compare models
stargazer(m1, m2, m2a, type="text", omit = "id",
dep.var.labels.include = FALSE,
add.lines = list(c("Fixed effects?", "No", "Yes", "Yes"),
c("Clustered SE?", "Yes", "No", "Yes")),
column.labels   = c("Clustered SE", "Fixed Effects", "Both"))
mean(diff$did[diff$treat == "treatment"], na.rm=TRUE) - mean(diff$did[diff$treat == "control"], na.rm=TRUE)
minstress = min(df2$stress, na.rm=TRUE)
maxstress = max(df2$stress, na.rm=TRUE)
minstress
maxstress
df2$stress
df2
df2
df
data = read.csv("./data.csv")
data
df
df2$comply = NA
a = which(df2$day == 8)
df2$comply[a] = df2$c1[a] # turns into factor
df2$day
df2$day == 9
df2$day == 8
df2$day == 1
df2$day == 1
levels(df2$day)
df2 = melt(df, id.var = c("id", "treat_code", "treat_group", "male", "age", "apple",
"personal_phone","phone_use", "relationship", "c1", "c2", "c3",
"c4", "c5", "c6", "c7"), variable.name = "day")
df2
levels(df2$day)
index = levels(df2$day)
values = c(1:14)
df2$day = values
index = levels(df2$day)
values = c(1:14)
df2$day = values[match(df2$day, index)]
df2$day
index = levels(df2$day)
levels(df2$day)
df2 = melt(df, id.var = c("id", "treat_code", "treat_group", "male", "age", "apple",
"personal_phone","phone_use", "relationship", "c1", "c2", "c3",
"c4", "c5", "c6", "c7"), variable.name = "day")
df2$day
levels(df2$day)
index = levels(df2$day)
values = c(1:14)
df2$day = values[match(df2$day, index)]
df2$day
df2$comply = NA
a = which(df2$day == 8)
a
df2$comply
df2$c1[a]
df2$comply[a] = df2$c1[a]
df2$comply
b = which(df2$day == 9)
df2$comply[b] = df2$c2[b]
df2$comply
c = which(df2$day == 10)
df2$comply[c] = df2$c3[c]
d = which(df2$day == 11)
df2$comply[d] = df2$c4[d]
e = which(df2$day == 12)
df2$comply[e] = df2$c5[e]
f = which(df2$day == 13)
df2$comply[f] = df2$c6[f]
g = which(df2$day == 14)
df2$comply[g] = df2$c7[g]
df2$comply
df2$comply[df$day == 8]
df2$comply[df2$day == 8]
df2$comply[df2$day == 14]
names(df2)
# drop c1-c7, rename 'value' to 'stress'
df2 = df2[,c(-10, -11, -12, -13, -14, -15, -16)]
colnames(df2)[11] <- "stress"
names(df2)
# create rows for difference-in-difference
baseline = df2[df2$day < 8,]
treatment = df2[df2$day > 7,]
did = treatment$stress - baseline$stress
# Build dataframe with DiD as outcome only
treat = df2[c(1:length(did)),]$treat_group
treat_code = df2[c(1:length(did)),]$treat_code
id = df2[c(1:length(did)),]$id
day = df2[c(1:length(did)),]$day
diff = data.frame(id, treat, treat_code, day, did)
# count of NA differences in treatment groups
sum(is.na(diff$did[diff$treat == "control"])) #38
sum(is.na(diff$did[diff$treat == "treatment"])) #61
# % NA DiD in control and treatment
38/sum(diff$treat == "control")
61/sum(diff$treat == "treatment")
# distribution by treatment group
ggplot(data.frame(diff$did), aes(x=diff$did, fill = diff$treat)) +
geom_bar(position="dodge") +
ggtitle("Difference in Difference of Stress Levels by Day of Week") +
labs(x="Stress DiD")
# boxplot by treatment group
ggplot(data.frame(diff$did), aes(x=diff$treat, y=diff$did, fill=diff$treat)) +
geom_boxplot() +
ggtitle("Difference in Difference of Stress Levels by Day of Week") +
labs(x="Stress DiD")
# model ignoring attrition and no clusters on ID
m1_wrong = lm(did ~ treat, data=diff)
# model WITH clusters on ID but ignoring attrition
m1_wrong$cluster.vcov = cluster.vcov(m1_wrong, ~ id)
m1 = coeftest(m1_wrong, m1_wrong$cluster.vcov)
# model ignoring attrition and using fixed effects by individual ID
m2 = lm(did ~ treat + factor(id), data = diff)
m2$cluster.vcov = cluster.vcov(m2, ~ id)
m2a = coeftest(m2, m2$cluster.vcov)
# Compare models
stargazer(m1, m2, m2a, type="text", omit = "id",
dep.var.labels.include = FALSE,
add.lines = list(c("Fixed effects?", "No", "Yes", "Yes"),
c("Clustered SE?", "Yes", "No", "Yes")),
column.labels   = c("Clustered SE", "Fixed Effects", "Both"))
nrow(diff) - sum(is.na(diff$did))
sum(df2$comply == 0, na.rm=TRUE)/sum(df2$treat_group == "treatment")
mean(diff$did[diff$treat == "treatment"], na.rm=TRUE) - mean(diff$did[diff$treat == "control"], na.rm=TRUE)
minstress = min(df2$stress, na.rm=TRUE)
maxstress = max(df2$stress, na.rm=TRUE)
minstress
maxstress
df2
df2$stress
df2$day == 1
df2[df2$day == 1,]
df2$maxstress = df2$stress
df2
df2$maxstress[df2$day == 1]
df2$maxstress[df2$day == 1] == NA
df2$maxstress[df2$day == 1].isnull()
df2$maxstress = df2$stress
df2$maxstress[df2$day == 1].isnull()
is.na(df2$maxstress[df2$day == 1])
is.na(df2$maxstress[df2$day == 1]) = maxstress
df2$maxstress[df2$day == 1]
df2[df2$day == 1,]$maxstress
df2$maxstress[df2$day == 1].isnull
df2$maxstress[df2$day == 1] == NA
is.na(df2$maxstress[df2$day == 1]) = maxstress
df2[df2$day == 1,]$maxstress
df2$maxstress[is.na(df2$maxstress[df2$day == 1])] = maxstress
df2$maxstress[df2$day == 1]
df2$maxstress[is.na(df2$maxstress[df2$day == 2])] = maxstress
df2$maxstress[df2$day == 2]
df2$maxstress = df2$stress
df2$maxstress[is.na(df2$maxstress[df2$day == 1])] = maxstress
df2$maxstress[is.na(df2$maxstress[df2$day == 1])] = maxstress
df2$maxstress[is.na(df2$maxstress[df2$day == 2])] = maxstress
df2$maxstress[is.na(df2$maxstress[df2$day == 3])] = maxstress
df2$maxstress[is.na(df2$maxstress[df2$day == 4])] = maxstress
df2$maxstress[is.na(df2$maxstress[df2$day == 5])] = maxstress
df2$maxstress[is.na(df2$maxstress[df2$day == 6])] = maxstress
df2$maxstress[is.na(df2$maxstress[df2$day == 7])] = maxstress
df2$maxstress
df2[c("day","maxstress"),]
df2[,c("day","maxstress")]
df2[,c("day","maxstress", "stress")]
df2$maxstress = df2$stress
df2$maxstress[is.na(df2$maxstress[df2$day == 1])] = maxstress
df2$maxstress[is.na(df2$maxstress[df2$day == 2])] = maxstress
df2$maxstress[is.na(df2$maxstress[df2$day == 3])] = maxstress
df2$maxstress[is.na(df2$maxstress[df2$day == 4])] = maxstress
df2$maxstress[is.na(df2$maxstress[df2$day == 5])] = maxstress
df2$maxstress[is.na(df2$maxstress[df2$day == 6])] = maxstress
df2$maxstress[is.na(df2$maxstress[df2$day == 7])] = maxstress
df2[,c("day","maxstress", "stress")]
df2$maxstress = df2$stress
df2$maxstress[is.na(df2$maxstress[df2$day == 1])]
is.na(df2$maxstress[df2$day == 1])
df2$maxstress[df2$day == 1]
is.na(df2$maxstress[df2$day == 1]) = maxstress
df2$maxstress[df2$day == 1]
df2[df2$day<6,]$stress
df2[df2$day<8,]$stress
is.na(df2[df2$day<8,]$stress)
df2[df2$day<8,]$stress[is.na(df2[df2$day<8,]$stress)]
df2[df2$day<8,]$maxstress[is.na(df2[df2$day<8,]$stress)] = maxstress
df2[,c("day","maxstress", "stress")]
df2$maxstress = df2$stress
df2[,c("day","maxstress", "stress")]
df2[df2$day<8,]$maxstress[is.na(df2[df2$day<8,]$stress)] = maxstress
df2[df2$day<8,]$maxstress[is.na(df2[df2$day<8,]$stress)]
df2$maxstress = df2$stress
df2[df2$day<8,]$maxstress[is.na(df2[df2$day<8,]$stress)]
df2[df2$day<8,]$maxstress[is.na(df2[df2$day<8,]$stress)] = maxstress
df2[,c("day","maxstress", "stress")]
df2[df2$day>7,]$maxstress[is.na(df2[df2$day>7,]$stress)] = minstress
df2[,c("day","maxstress", "stress")]
baseline = df2[df2$day < 8,]
treatment = df2[df2$day > 7,]
max_did = treatment$maxstress - baseline$mastress
treat = df2[c(1:length(did)),]$treat_group
treat_code = df2[c(1:length(did)),]$treat_code
id = df2[c(1:length(did)),]$id
day = df2[c(1:length(did)),]$day
max_diff = data.frame(id, treat, treat_code, day, did)
max_diff
max_diff = data.frame(id, treat, treat_code, day, max_did)
max_diff
max_did
max_did = treatment$maxstress - baseline$mastress
max_did
max_did = treatment$maxstress - baseline$maxstress
max_did
treat = df2[c(1:length(did)),]$treat_group
treat_code = df2[c(1:length(did)),]$treat_code
id = df2[c(1:length(did)),]$id
day = df2[c(1:length(did)),]$day
max_diff = data.frame(id, treat, treat_code, day, max_did)
max_diff
ggplot(data.frame(max_diff$max_did), aes(x=max_diff$max_did, fill = max_diff$treat)) +
geom_bar(position="dodge") +
ggtitle("Difference in Difference of Stress Levels by Day of Week") +
labs(x="Stress DiD")
mean(max_diff)
mean(max_diff, na.rm=TRUE)
mean(max_diff$max_did, na.rm=TRUE)
mean(diff$did, na.rm=TRUE)
# boxplot by treatment group
ggplot(data.frame(max_diff$max_did), aes(x=max_diff$max_did, fill = max_diff$treat)) +
geom_boxplot() +
ggtitle("Difference in Difference of Stress Levels by Day of Week") +
labs(x="Stress DiD")
# boxplot by treatment group
ggplot(data.frame(max_diff$max_did), aes(x=max_diff$max_did,
y=max_diff$treat,
fill=max_diff$treat)) +
geom_boxplot() +
ggtitle("Difference in Difference of Stress Levels by Day of Week") +
labs(x="Stress DiD")
ggplot(data.frame(max_diff$max_did), aes(x=max_diff$treat,
y=max_diff$max_did,
fill=max_diff$treat)) +
geom_boxplot() +
ggtitle("Difference in Difference of Stress Levels by Day of Week") +
labs(x="Stress DiD")
max1_wrong = lm(max_did ~ treat, data=max_diff)
summary(max1_wrong)
max1_wrong$cluster.vcov = cluster.vcov(max1_wrong, ~ id)
max1 = coeftest(max1_wrong, max1_wrong$cluster.vcov)
max1
max2 = lm(max_did ~ treat + factor(id), data = max_diff)
summary(max2)
max2$cluster.vcov = cluster.vcov(max2, ~ id)
max2a = coeftest(max2, max2$cluster.vcov)
max2a
stargazer(max1, max2, max2a, type="text", omit = "id",
dep.var.labels.include = FALSE,
add.lines = list(c("Fixed effects?", "No", "Yes", "Yes"),
c("Clustered SE?", "Yes", "No", "Yes")),
column.labels   = c("Clustered SE", "Fixed Effects", "Both"))
nrow(max_diff) - sum(is.na(max_diff$max_did))
sum(is.na(max_diff$max_did))
max_diff[max_diff$treat == 1]
max_diff[max_diff$treat == 1,]
max_diff
max_diff[max_diff$treat == "treatment",]
max_diff[max_diff$treat == "treatment",]$max_did
mean(max_diff[max_diff$treat == "treatment",]$max_did) -
mean(max_diff[max_diff$treat == "control",]$max_did)
# Compare models
stargazer(max1, max2, max2a, type="text", omit = "id",
dep.var.labels.include = FALSE,
add.lines = list(c("Fixed effects?", "No", "Yes", "Yes"),
c("Clustered SE?", "Yes", "No", "Yes")),
column.labels   = c("Clustered SE", "Fixed Effects", "Both"))
df2$minstress = df2$stress
df2[df2$day<8,]$maxstress[is.na(df2[df2$day<8,]$stress)] = maxstress
df2[df2$day>7,]$maxstress[is.na(df2[df2$day>7,]$stress)] = minstress
df2$minstress = df2$stress
df2[df2$day<8,]$minstress[is.na(df2[df2$day<8,]$stress)] = minstress
df2[df2$day>7,]$minstress[is.na(df2[df2$day>7,]$stress)] = maxstress
df2[,c("day", "treat", "stress", "minstress")]
df2[,c("day", "treat", "stress", "minstress")]
df2$minstress = df2$stress
df2[df2$day<8,]$minstress[is.na(df2[df2$day<8,]$stress)] = minstress
df2[df2$day>7,]$minstress[is.na(df2[df2$day>7,]$stress)] = maxstress
df2
df2[,c("day", "stress", "minstress")]
baseline = df2[df2$day < 8,]
treatment = df2[df2$day > 7,]
min_did = treatment$minstress - baseline$minstress
min_did
treat = df2[c(1:length(did)),]$treat_group
treat_code = df2[c(1:length(did)),]$treat_code
id = df2[c(1:length(did)),]$id
day = df2[c(1:length(did)),]$day
min_diff = data.frame(id, treat, treat_code, day, min_did)
ggplot(data.frame(min_diff$min_did), aes(x=min_diff$min_did, fill = min_diff$treat)) +
geom_bar(position="dodge") +
ggtitle("Difference in Difference of Stress Levels by Day of Week") +
labs(x="Stress DiD")
# boxplot by treatment group
ggplot(data.frame(min_diff$min_did), aes(x=min_diff$treat,
y=min_diff$min_did,
fill=min_diff$treat)) +
geom_boxplot() +
ggtitle("Difference in Difference of Stress Levels by Day of Week") +
labs(x="Stress DiD")
mean(min_diff[min_diff$treat == "treatment",]$min_did) -
mean(min_diff[min_diff$treat == "control",]$min_did)
min1_wrong = lm(min_did ~ treat, data=min_diff)
summary(min1_wrong)
min1_wrong$cluster.vcov = cluster.vcov(min1_wrong, ~ id)
min1 = coeftest(min1_wrong, min1_wrong$cluster.vcov)
min1
min2 = lm(min_did ~ treat + factor(id), data = min_diff)
summary(min2)
min2$cluster.vcov = cluster.vcov(min2, ~ id)
min2a = coeftest(min2, min2$cluster.vcov)
min2a
# Compare models
stargazer(min1, min2, min2a, type="text", omit = "id",
dep.var.labels.include = FALSE,
add.lines = list(c("Fixed effects?", "No", "Yes", "Yes"),
c("Clustered SE?", "Yes", "No", "Yes")),
column.labels   = c("Clustered SE", "Fixed Effects", "Both"))
ggplot(data.frame(max_diff$max_did), aes(x=max_diff$treat,
y=max_diff$max_did,
fill=max_diff$treat)) +
geom_boxplot() +
ggtitle("Difference in Difference of Stress Levels by Day of Week") +
labs(x="Stress DiD")
summary(max_diff$max_did)
tapply(max_diff$max_did, max_diff$treat, summary)
data.frame(tapply(max_diff$max_did, max_diff$treat, summary))
ggplot(data.frame(min_diff$min_did), aes(x=min_diff$treat,
y=min_diff$min_did,
fill=min_diff$treat)) +
geom_boxplot() +
ggtitle("Difference in Difference of Stress Levels by Day of Week") +
labs(x="Stress DiD")
stargazer(min1, min2, min2a, type="text", omit = "id",
dep.var.labels.include = FALSE,
add.lines = list(c("Fixed effects?", "No", "Yes", "Yes"),
c("Clustered SE?", "Yes", "No", "Yes")),
column.labels   = c("Clustered SE", "Fixed Effects", "Both"))
